<!DOCTYPE html>

<html lang="pt">
    <head>
        <meta charset="UTF-8">
        <title>Sessão E-Floresta</title>
        <link rel="stylesheet" href="create-and-login.css">
    </head>

    <script>
        xmlhttp = new XMLHttpRequest();
        let token;

        function login() {
            xmlhttp.onreadystatechange = function() {
                if(xmlhttp.readyState == 4) {
                    if(xmlhttp.status == 200){
                        token = xmlhttp.responseText;
                        alert("Login efetuado com sucesso.");
                        sessionStorage.setItem('token', token);
                        window.location.href = "logged-homepage.html";
                    }
                }
            }
            var myObj = {password:document.getElementById("session-password").value};
            var myJson = JSON.stringify(myObj);

            xmlhttp.open("POST", "https://modified-talon-344017.oa.r.appspot.com/rest/login/"+document.getElementById("session-username").value, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.send(myJson);
        }

        function register() {
            xmlhttp.onreadystatechange = function() {
                if(xmlhttp.readyState == 4) {
                    if(xmlhttp.status == 200){
                        alert("Registo efetuado com sucesso.");
                        window.location.href = "logged-homepage.html";
                    }
                }
            }
            var myObj = {username:document.getElementById("create-acc-user").value,
                password:document.getElementById("create-acc-pass").value,
                confirmation:document.getElementById("create-acc-conf-pass").value,
                email:document.getElementById("create-acc-email").value,
                name:document.getElementById("create-acc-name").value,
                phone:document.getElementById("create-acc-phone").value,
                nif:document.getElementById("create-acc-nif").value
            };
            var myJson = JSON.stringify(myObj);

            xmlhttp.open("POST", "https://modified-talon-344017.oa.r.appspot.com/rest/register/"+document.getElementById("session-username").value, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.send(myJson);
        }


    </script>

    <body>
        <div class="top">
            <div class="title">
                <h1>E-Floresta</h1>
            </div>
        </div>

        <div class="session-body">
            <div class="initiate-session">
                <h2 class="align-content">Iniciar sessão</h2>

                <input class="align-content" id="session-username" type="text" placeholder="Username/E-mail">
                <input class="align-content" id="session-password" type="password" placeholder="Password">

                <input class="button" type="button" value="Entrar" onclick="login();">

            </div>

            <div class="division"> </div>

            <div class="create-account">
                <h2 class="align-content">Registe-se</h2>
                <p class="align-content">Ainda não tem conta?</p>
                <p class="align-content">Registe-se agora!</p>

                <p>Campos obrigatórios: </p>
                <input class="align-content" id="create-acc-user" type="text" placeholder="Username">
                <input class="align-content" id="create-acc-email" type="email" placeholder="E-mail">
                <input class="align-content" id="create-acc-pass" type="password" placeholder="Password">
                <input class="align-content" id="create-acc-conf-pass" type="password" placeholder="Confirmar Password">

                <p>Campos opcionais: </p>
                <input class="align-content" id="create-acc-name" type="text" placeholder="Nome Completo" maxlength="9">
                <input class="align-content" id="create-acc-phone" type="text" placeholder="Telemóvel/Telefone" maxlength="9">
                <input class="align-content" id="create-acc-nif" type="text" placeholder="NIF" maxlength="9">

                <input class="button" type="button" value="Registar" onclick="register();">
            </div>
        </div>
    </body>
</html>